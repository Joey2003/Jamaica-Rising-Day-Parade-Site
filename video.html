<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="Styles/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>test page</title>
</head>


<body>
    <header id="header">
        <h1><span class="name">JDP</span> <span class="title">Logo</span></h1>
        <div style="height: 100vh;position: relative;pointer-events: none;"></div>
    </header>
    <div class="viewport-wrapper">
        <div class="content-scroll">
            <main class="main-content">

                <section class="stack">
                    <ul class="snap-scroller">
                        <li class="snap-item" id="one"><a href="https://codepen.io/lauraculham/" target="_blank">The
                                streets come alive inâ€¦
                                <div style="width: fit-content; margin-top: -5px;" class="list-pic">
                                    <iframe src="countdown.html" style="height: 1rem; pointer-events: none;" width="100"
                                        height="100" style="border: medium;"></iframe>
                                </div>
                                Brooklyn, NY
                            </a>
                        </li>
                        <li class="snap-item" id="two"><a href="#" target="_blank">What?
                                <div style="width: fit-content;" class="list-pic">Picture</div>
                            </a></li>
                        <li class="snap-item" id="three"><a href="#" target="_blank">Socials
                                <div style="width: fit-content;" class="list-pic">Videos</div>
                            </a></li>
                        <li class="snap-item" id="four"><a href="#">Contact Us
                                <div style="width: fit-content;" class="list-pic">Card</div>
                            </a></li>
                    </ul>
                    <div id="video_01" class="sv-wrapper" data-duration="5.50">
                        <div class="sv-pin-container">
                            <video class="sv-video" tabindex="-1" width="1920" height="1080" alt="" preload="none"
                                webkit-playsinline playsinline muted crossorigin src="Images/output_bg.mp4"
                                poster="https://www.lessrain.com/dev/videos/forest/forest_poster.webp"></video>
                            <div class="sv-preloader"></div>
                        </div>
                        <div class="sv-overlay-track">
                            <div class="sv-overlay-markers"></div>

                        </div>
                    </div>
                </section>
                <footer>
                    <h1><span>Footer</span></h1>
                </footer>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
                <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/ScrollSmoother.min.js"></script>
                <script src="https://assets.codepen.io/573855/utils-v3.js"></script>


                <!-- Your app files AFTER the libs. Keep only one gsap core include (remove Scripts/gsap.min.js if it's the same). -->
                <script src="Scripts/scrollPlay.js"></script>
                <!-- <script src="Scripts/zoomElem.js"></script> -->
                <script>
                    gsap.registerPlugin(ScrollTrigger);

                    // helper: pin + scrub + zoom + robust show/hide
                    function zoomPin(selector, scale, end = "+=300%") {
                        const el = document.querySelector(selector);
                        if (!el) return;

                        gsap.set(el, { transformOrigin: "50% 50%", scale: 1.2 });

                        gsap.timeline({
                            scrollTrigger: {
                                trigger: el,
                                start: "top top",     // tiny offset so we truly "enter" the scene
                                end,
                                scrub: true,
                                pin: true,
                                pinSpacing: false,       // keep it overlaid on the video
                                pinReparent: true,
                                anticipatePin: 1,        // stabilizes first enter with pins
                                onEnter: () => el.classList.add("showing"),
                                onEnterBack: () => el.classList.add("showing"),
                                onLeave: () => el.classList.remove("showing"),
                                onLeaveBack: () => el.classList.remove("showing"),
                                // markers: true
                            }
                        })
                            .to(el, { scale, ease: "none" }); // ease "none" plays nicest with scrub
                    }

                    // init after your smoother + video scrub are set up
                    function initZoomScenes() {
                        if (!matchMedia("(min-width: 768px)").matches) return;
                        zoomPin("#one", 100, "+=100%");
                        zoomPin("#two", 100, "+=100%");
                        zoomPin("#three", 100, "+=100%");
                        zoomPin("#four", 100, "+=250%");

                        // bottom-of-page toggle (same as before)
                        const emailLink = document.querySelector("#four a");
                        if (emailLink) {
                            const computeBottomPoint = () =>
                                document.documentElement.scrollHeight - window.innerHeight * 1.5;

                            ScrollTrigger.create({
                                start: () => computeBottomPoint(),
                                end: () => computeBottomPoint() + 1,
                                onEnter: () => emailLink.classList.add("email-showing"),
                                onLeaveBack: () => emailLink.classList.remove("email-showing")
                            });
                        }
                    }

                    // call after your existing DOMContentLoaded init (smoother + scrub)
                    document.addEventListener("DOMContentLoaded", () => {
                        // ... your existing init code already runs here ...
                        initZoomScenes();
                        ScrollTrigger.refresh();
                    });


                </script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollToPlugin.min.js"></script>
                <script>
                    gsap.registerPlugin(ScrollToPlugin);

                    // Hardcoded snap points (px)
                    const snapPoints = [3, 1100, 2100, 3200];

                    let inputDir = 0;          // -1 up, +1 down, 0 unknown
                    let isTweening = false;
                    let timer = null;
                    const SNAP_DELAY = 100;    // ms after input ends
                    const DEADZONE = 40;       // px: if close enough, snap to that point

                    function scheduleSnap() {
                        clearTimeout(timer);
                        timer = setTimeout(runSnap, SNAP_DELAY);
                    }

                    function runSnap() {
                        if (isTweening) return;

                        const y = window.scrollY;

                        // 1) If we're already close to any snap point, just land there.
                        let nearest = snapPoints[0];
                        let minDist = Math.abs(y - nearest);
                        for (let i = 1; i < snapPoints.length; i++) {
                            const d = Math.abs(y - snapPoints[i]);
                            if (d < minDist) { minDist = d; nearest = snapPoints[i]; }
                        }
                        if (minDist <= DEADZONE) {
                            tweenTo(nearest);
                            return;
                        }

                        // 2) Determine the current segment (floor index)
                        //    idx so that snapPoints[idx] <= y < snapPoints[idx+1]
                        let idx = 0;
                        while (idx < snapPoints.length - 1 && y >= snapPoints[idx + 1]) idx++;

                        // 3) Decide target by user direction (fallback to nearest if unknown)
                        let target;
                        if (inputDir < 0) { // UP
                            target = snapPoints[Math.max(0, idx)];
                        } else if (inputDir > 0) { // DOWN
                            target = snapPoints[Math.min(snapPoints.length - 1, idx + 1)];
                        } else {
                            target = nearest; // no clear direction (e.g., keyboard), use nearest
                        }

                        tweenTo(target);
                    }

                    function tweenTo(targetY) {
                        isTweening = true;
                        gsap.to(window, {
                            scrollTo: targetY,
                            duration: 0.6,
                            ease: "power2.out",
                            onComplete: () => (isTweening = false)
                        });
                    }

                    /* -------------------------
                       INPUT: only real user input
                    --------------------------*/

                    // Wheel: deltaY > 0 => down, < 0 => up
                    window.addEventListener("wheel", (e) => {
                        if (isTweening) return;
                        inputDir = Math.sign(e.deltaY);
                        scheduleSnap();
                    }, { passive: true });

                    // Touch: compare scrollY between touchstart and touchend
                    let touchStartY = 0;
                    window.addEventListener("touchstart", () => {
                        touchStartY = window.scrollY;
                    }, { passive: true });

                    window.addEventListener("touchend", () => {
                        if (isTweening) return;
                        const dy = window.scrollY - touchStartY;
                        inputDir = Math.sign(dy);   // >0 down, <0 up
                        scheduleSnap();
                    }, { passive: true });

                    /* Optional: keyboard arrows/PageUp/PageDown/Home/End */
                    window.addEventListener("keydown", (e) => {
                        if (isTweening) return;
                        if (["ArrowDown", "PageDown", "ArrowUp", "PageUp", "Home", "End", " "].includes(e.key)) {
                            inputDir = (e.key === "ArrowUp" || e.key === "PageUp") ? -1 :
                                (e.key === "Home" ? -1 :
                                    (e.key === "End" || e.key === " " || e.key === "ArrowDown" || e.key === "PageDown") ? 1 : 0);
                            scheduleSnap();
                        }
                    });

                </script>
                <script>
                    const iframe = document.getElementById("myFrame");
                    iframe.addEventListener("load", () => {
                        // ensure layout and CSS are fully ready before fade-in
                        requestAnimationFrame(() => iframe.style.opacity = 1);
                    });
                </script>
            </main>
        </div>
    </div>

</body>

</html>